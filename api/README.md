# Church Web Administration - API (Backend)

This directory contains the backend API for the Church Web Administration project, built using NestJS. It provides the core logic and data management for the application.

## Overview

This NestJS application serves as the backend for managing various aspects of the church's online presence. It exposes a RESTful API that the frontend (`web` directory) consumes to display and interact with data.

## Key Features

- **Member Management:** API endpoints for managing church member profiles, contact information, and other relevant details.
- **Event Management:** Functionality to create, update, and retrieve event information, including dates, times, locations, and descriptions.
- **Donation Management:** Securely handle donations and manage giving records.
- **Sermon/Media Library:** Store and serve audio/video sermons and other media content.
- **News/Blog:** API endpoints for managing news articles and blog posts.
- **User Authentication:** Secure user authentication and authorization to protect sensitive data.
- **Database Integration:** Utilizes a database (e.g., PostgreSQL, MySQL) for persistent data storage.
- **Data Validation:** Ensures data integrity through robust validation mechanisms.

## Prerequisites

- Node.js (v18 or higher)
- npm or yarn
- SQLite3

## Installation

1. Clone the repository
2. Install dependencies:

```bash
npm install
```

3. Create a `.env` file in the root directory with the following variables:

```env
JWT_SECRET=your_jwt_secret_here
```

## Running the Application

Development mode:

```bash
npm run start:dev
```

Production mode:

```bash
npm run build
npm run start:prod
```

## User Management

### Creating New Users

Since the public registration endpoint has been removed for security reasons, new users can only be created using the command-line script:

```bash
npm run register-user <email> <password> <firstName> <lastName>
```

Example:

```bash
npm run register-user "admin@church.com" "admin123" "Admin" "User"
```

The script will:

1. Validate the input
2. Check if a user with the provided email already exists
3. Hash the password securely using bcrypt
4. Create a new user with the provided details
5. Return the created user information (without the password)

Output example:

```
User registered successfully: {
  id: 2,
  email: 'admin@church.com',
  firstName: 'Admin',
  lastName: 'User'
}
```

If a user with the provided email already exists, the script will display an error message and exit without creating a new user.

## API Routes

The API exposes the following endpoints:

### Authentication

- `POST /auth/login` - Login with email and password

### Links Management

- `GET /links` - Get all live streams
- `PUT /links/:id` - Update a live stream by ID

### Root

- `GET /` - Health check endpoint

## API Response Format

### Success Response

All successful responses are wrapped in a `data` field:

```json
{
  "data": {
    // response data here
  }
}
```

### Error Response

All error responses are wrapped in an `error` field with appropriate HTTP status codes:

```json
{
  "error": {
    "message": "Error message here"
  }
}
```

Common HTTP Status Codes:

- `200` - Success
- `400` - Bad Request
- `401` - Unauthorized
- `404` - Not Found
- `500` - Internal Server Error

## Technologies

- NestJS: A progressive Node.js framework for building efficient and scalable server-side applications.
- TypeScript: A typed superset of JavaScript.
- TypeORM (Likely): An ORM for database interaction.
- Passport (Likely): For authentication.
- JWT (Likely): For token-based authentication.

## Getting Started

1.  **Installation:**

    ```bash
    $ npm install
    ```

2.  **Environment Variables:**

    - Create a `.env` file in the root of the `api` directory.
    - Define necessary environment variables (e.g., database connection details, JWT secret).

3.  **Database Setup:**

    - Create the database specified in your `.env` file.
    - Run database migrations (if using TypeORM).

4.  **Running the API:**

    ```bash
    # Development mode (with hot-reloading)
    $ npm run start:dev

    # Production mode
    $ npm run start:prod
    ```

## API Documentation

- API documentation will be generated by swagger or other tools.

## Contributing

Contributions to the API are welcome! Please see the `CONTRIBUTING.md` file for guidelines.

## License

MIT

## Testing

```bash
# unit tests
npm run test

# e2e tests
npm run test:e2e

# test coverage
npm run test:cov
```
