---
import MainLayout from "../layouts/main.astro";
import DashboardNav from "../components/DashboardNav.astro";
import LiveStreamForm from "../components/LiveStreamForm.astro";
---

<MainLayout content={{ title: "Dashboard" }}>
  <script>
    // Client-side authentication check
    if (typeof window !== "undefined") {
      const session = localStorage.getItem("session");

      // For the demo, if no session exists, create a temp one
      if (!session) {
        // For development only - in production, redirect to login
        // window.location.href = "/login";
        // return;

        // Create a temporary session for demonstration purposes
        const tempSession = {
          user: { firstName: "Admin", lastName: "User" },
          token: "demo-token",
        };
        localStorage.setItem("session", JSON.stringify(tempSession));

        document.addEventListener("DOMContentLoaded", () => {
          const welcomeMessage = document.querySelector(".welcome-message");
          if (welcomeMessage) {
            welcomeMessage.textContent = `Welcome, ${tempSession.user.firstName}!`;
          }
        });
      } else {
        // Use the existing session
        try {
          const user = JSON.parse(session).user;
          document.addEventListener("DOMContentLoaded", () => {
            const welcomeMessage = document.querySelector(".welcome-message");
            if (welcomeMessage) {
              welcomeMessage.textContent = `Welcome, ${user?.firstName || "Admin"}!`;
            }
          });
        } catch (e) {
          console.error("Error parsing session:", e);
        }
      }
    }
  </script>
  <div class="min-h-screen bg-gray-100">
    <DashboardNav />

    <main class="py-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold text-gray-900">Dashboard</h1>

        <div class="mt-4">
          <div class="bg-white shadow rounded-lg p-6">
            <h2 class="text-lg font-medium text-gray-900 welcome-message">
              Welcome!
            </h2>
            <p class="mt-1 text-sm text-gray-500">
              You're logged in successfully.
            </p>
          </div>

          <LiveStreamForm />
        </div>
      </div>
    </main>
  </div>
</MainLayout>
